{% extends 'base.html' %}

{% block content %}
{% if pages %}
<div class="row">
<div class="span3">
<ul id="left_nav" class="nav nav-list affix">
  <li class="nav-header">Control Panel</li>
  <li><a href="#overview"><i class="icon-plus"></i> New Alert</a></li>
  <li><a href="#overview"><i class="icon-th-list"></i> Overview</a></li>
  <li><a href="#recent_changes"><i class="icon-eye-open"></i> Recent Changes</a></li>
  <li><a href="#social_news"><i class="icon-share"></i> Social News</a></li>
</ul>
</div>
<div class="span9">
<a href="/page/new" class="btn btn-primary"><i class="icon-plus"></i> New alert</a>
<p class="alert alert-info" style="margin-top:15px">
Sorry, Watchtower is in closed beta and free accounts are NOT being processed for monitoring.  We'll notify you when scans have resumed.
</p>

<h3 id="overview">Monitoring Overview</h3>
<table class="table table-bordered table-striped" style="margin-top:20px;">
  <tbody>
    <tr>
      <th>Page</th>
      <th>New changes</th>
      <th style="width:5px"></th>
      <th style="width:5px"></th>
    </tr>
    {% for page in pages %}
      <tr>
        <td><a href="/page/{{ page.id }}">{{ page.name }}</a></td>
        <td>{{ page.num_new_changes }}</td>
        <td><a href=/page/{{ page.id }}/edit><i class="icon-edit"></i> </a></td>
        <td><a href=/page/{{ page.id }}/delete><i class="icon-remove"></i> </a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

<h3 id="recent_changes">Recent Changes</h3>
<table class="table table-bordered table-striped">
{% for version in all_versions[:25] %}
  <tr>
  {% set page = (version|page_from_version) %}
  {% set time = version.when.strftime('%b %d %I:%M %p') %}

  {% if time != prevtime %}
    <td style="width: 150px">{{ time }}</td>
    {% set prevtime = time %}
  {% else %}
    <td></td>
  {% endif %}

  <td><em>{{ (version|element_from_version).name }}</em> on <strong><a href="/page/{{ page.id }}">{{ page.name }}</a></strong> changed <a href="https://s3.amazonaws.com/watchtower-screenshots/{{version.screenshot}}" target="_blank"><i class="screenshot-preview icon-zoom-in" data-screenshot-url="{{ version.screenshot }}"></i></a></td>
  </tr>
{% endfor %}
</table>
</div> {# end div right span #}
</div> {# end div row #}
{% else %}
<div class="row span12">
</br>
<p class="alert alert-error">
  No alerts have been created!
</p>
</div>
<div class="row span12">
  <p class="alert alert-info">
    Click "New alert" to start monitoring pages.
  </p>
</div>
</div>
{% endif %}
{% if pages %}
<div class="row span12" style="display: none" id="social">
  <h3 id="social_news">Social News</h3>
  <div class="accordion" id="news">
  </div>
  <div class="accordion" id="twitter">
<div>
{% endif %}
{% endblock %}

{% block scripts %}
<script src="/static/js/dashboard.js"></script>

<script type="text/html" id="news_page_tmpl">
  <div class="accordion-group">
    <div class="accordion-heading" style="background-color: #f9f9f9>
      <a class="accordion-toggle" data-toggle="collapse" data-parent="<%=parent%>" href="#collapse<%=page_id%>">
        <%=page%>
      </a>
    </div>
    <div id="collapse<%=page_id%>" class="accordion-body collapse in">
      <%=inner%>
    </div>
  </div>
</script>

<script type="text/html" id="news_story_tmpl">
  <div class="accordion-inner">
    <a href="<%=link%>"><%=headline%></a>
  </div>
</script>
<script type="text/html" id="twitter_tmpl">
  <div class="accordion-inner">
    <p><%=text%></p>
  </div>
</script>
{% endblock %}

